(function(t){function i(t,i){t.prototype=Object.create(i.prototype),t.prototype.$super=i.prototype}function h(){return[].slice.call(arguments).reduce(function(t,i){return void 0!==t?t:i})}function e(t,i){var h=t-i;switch(d.INTERNAL_ALIGNMENT){case"left":return[0,h];case"right":return[h,0];case"center":default:return[h/2,h/2]}}function s(t){return"string"==typeof t?new g(t):t}function n(t){for(var i=0;i<t.length;i++)if(t[i]instanceof c&&i!==t.length-1)return!0;return!1}function r(t,i,h){i=i||{},h=h||"";var e=document.createElementNS("http://www.w3.org/2000/svg",t);for(var s in i)"xlink:href"===s?e.setAttributeNS("http://www.w3.org/1999/xlink","href",i[s]):e.setAttribute(s,i[s]);return e.textContent=h,e}function o(t,i,e){return this instanceof o?(this.children=e?e:[],this.tagName=t,this.attrs=h(i,{}),this):new o(t,i,e)}function a(t,i){return this instanceof a?(o.call(this,"path"),void(this.attrs.d="M"+t+" "+i)):new a(t,i)}function d(t){if(!(this instanceof d))return new d([].slice.call(arguments));if(o.call(this,"svg",{"class":d.DIAGRAM_CLASS}),n(t))throw new RangeError("Stack() must only occur at the very last position of Diagram().");this.items=t.map(s),this.items.unshift(new R),this.items.push(new l),this.width=this.items.reduce(function(t,i){return t+i.width+(i.needsSpace?20:0)},0)+1,this.height=this.items.reduce(function(t,i){return t+i.height},0),this.up=Math.max.apply(null,this.items.map(function(t){return t.up})),this.down=Math.max.apply(null,this.items.map(function(t){return t.down})),this.formatted=!1}function u(){var t=new d([].slice.call(arguments)),i=t.items;return i.shift(),i.pop(),i.unshift(new R(!1)),i.push(new l(!1)),t.items=i,t}function f(t){if(!(this instanceof f))return new f([].slice.call(arguments));if(o.call(this,"g"),n(t))throw new RangeError("Stack() must only occur at the very last position of Sequence().");this.items=t.map(s),this.width=this.items.reduce(function(t,i){return t+i.width+(i.needsSpace?20:0)},0),this.offsetX=0,this.height=this.items.reduce(function(t,i){return t+i.height},0),this.up=this.items.reduce(function(t,i){return Math.max(t,i.up)},0),this.down=this.items.reduce(function(t,i){return Math.max(t,i.down)},0)}function c(t){if(!(this instanceof c))return new c([].slice.call(arguments));if(o.call(this,"g"),n(t))throw new RangeError("Stack() must only occur at the very last position of Stack().");if(0===t.length)throw new RangeError("Stack() must have at least one child.");this.items=t.map(s),this.width=this.items.reduce(function(t,i){return Math.max(t,i.width+(i.needsSpace?20:0))},0),this.items.length>1&&(this.width+=2*d.ARC_RADIUS),this.up=this.items[0].up,this.down=this.items[this.items.length-1].down,this.height=0;for(var i=0;i<this.items.length;i++)this.height+=this.items[i].height,i!==this.items.length-1&&(this.height+=Math.max(this.items[i].down,d.VERTICAL_SEPARATION)+Math.max(this.items[i+1].up,d.VERTICAL_SEPARATION)+4*d.ARC_RADIUS);0===this.items.length?this.offsetX=0:(this.offsetX=-(this.width-this.items[this.items.length-1].width-this.items[this.items.length-1].offsetX-(this.items[this.items.length-1].needsSpace?20:0)),this.items.length>1&&(this.offsetX+=2*d.ARC_RADIUS))}function p(t,i){if(!(this instanceof p))return new p(t,[].slice.call(arguments,1));if(o.call(this,"g"),"number"!=typeof t||t!==Math.floor(t))throw new TypeError("The first argument of Choice() must be an integer.");if(0>t||t>=i.length)throw new RangeError("The first argument of Choice() must be an index for one of the items.");this.normal=t,this.items=i.map(s),this.width=this.items.reduce(function(t,i){return Math.max(t,i.width)},0)+4*d.ARC_RADIUS,this.offsetX=0,this.height=this.items[t].height,this.up=this.down=0;for(var h=0;h<this.items.length;h++){var e=this.items[h];t>h&&(this.up+=Math.max(d.ARC_RADIUS,e.up+e.height+e.down+d.VERTICAL_SEPARATION)),h==t&&(this.up+=Math.max(d.ARC_RADIUS,e.up),this.down+=Math.max(d.ARC_RADIUS,e.down)),h>t&&(this.down+=Math.max(d.ARC_RADIUS,d.VERTICAL_SEPARATION+e.up+e.down+e.height))}}function m(t,i){if(void 0===i)return p(1,I(),t);if("skip"===i)return p(0,I(),t);throw"Unknown value for Optional()'s 'skip' argument."}function A(t,i){return this instanceof A?(o.call(this,"g"),i=i||new I,this.item=s(t),this.rep=s(i),this.width=Math.max(this.item.width,this.rep.width)+2*d.ARC_RADIUS,this.offsetX=0,this.height=this.item.height,this.up=this.item.up,void(this.down=Math.max(2*d.ARC_RADIUS,this.item.down+d.VERTICAL_SEPARATION+this.rep.up+this.rep.height+this.rep.down))):new A(t,i)}function w(t,i,h){return m(A(t,i),h)}function R(t){return this instanceof R?(o.call(this,"path"),this.width=20,this.height=0,this.offsetX=0,this.up=10,this.down=10,void(this.simpleType=t)):new R}function l(t){return this instanceof l?(o.call(this,"path"),this.width=20,this.height=0,this.offsetX=0,this.up=10,this.down=10,void(this.simpleType=t)):new l}function g(t,i){return this instanceof g?(o.call(this,"g",{"class":"terminal"}),this.text=t,this.href=i,this.width=8*t.length+20,this.height=0,this.offsetX=0,this.up=11,void(this.down=11)):new g(t,i)}function S(t,i){return this instanceof S?(o.call(this,"g",{"class":"non-terminal"}),this.text=t,this.href=i,this.width=8*t.length+20,this.height=0,this.offsetX=0,this.up=11,void(this.down=11)):new S(t,i)}function T(t){return this instanceof T?(o.call(this,"g"),this.text=t,this.width=7*t.length+10,this.height=0,this.offsetX=0,this.up=11,void(this.down=11)):new T(t)}function I(){return this instanceof I?(o.call(this,"g"),this.width=0,this.height=0,this.offsetX=0,this.up=0,void(this.down=0)):new I}o.prototype.format=function(){},o.prototype.addTo=function(t){if(t instanceof o)return t.children.push(this),this;var i=this.toSVG();return t.appendChild(i),i},o.prototype.escapeString=function(t){return t.replace(/[*_\`\[\]<&]/g,function(t){return"&#"+t.charCodeAt(0)+";"})},o.prototype.toSVG=function(){var t=r(this.tagName,this.attrs);return"string"==typeof this.children?t.textContent=this.children:this.children.forEach(function(i){t.appendChild(i.toSVG())}),t},o.prototype.toString=function(){var t="<"+this.tagName,i="g"==this.tagName||"svg"==this.tagName;for(var h in this.attrs)t+=" "+h+'="'+(this.attrs[h]+"").replace(/&/g,"&").replace(/"/g,"&quot;")+'"';return t+=">",i&&(t+="\n"),"string"==typeof this.children?t+=o.prototype.escapeString(this.children):this.children.forEach(function(i){t+=i}),t+="</"+this.tagName+">\n"},i(a,o),a.prototype.m=function(t,i){return this.attrs.d+="m"+t+" "+i,this},a.prototype.h=function(t){return this.attrs.d+="h"+t,this},a.prototype.right=a.prototype.h,a.prototype.left=function(t){return this.h(-t)},a.prototype.v=function(t){return this.attrs.d+="v"+t,this},a.prototype.down=a.prototype.v,a.prototype.up=function(t){return this.v(-t)},a.prototype.arc=function(t){var i=d.ARC_RADIUS,h=d.ARC_RADIUS;if(("e"==t[0]||"w"==t[1])&&(i*=-1),("s"==t[0]||"n"==t[1])&&(h*=-1),"ne"==t||"es"==t||"sw"==t||"wn"==t)var e=1;else var e=0;return this.attrs.d+="a"+d.ARC_RADIUS+" "+d.ARC_RADIUS+" 0 0 "+e+" "+i+" "+h,this},a.prototype.format=function(){return this.attrs.d+="h.5",this},i(d,o);for(var C in t)d[C]=t[C];d.prototype.format=function(t,i,e,s){t=h(t,20),i=h(i,t,20),e=h(e,t,20),s=h(s,i,20);var n=s,r=t;r+=this.up;for(var u=o("g",d.STROKE_ODD_PIXEL_LENGTH?{transform:"translate(.5 .5)"}:{}),f=0;f<this.items.length;f++){var c=this.items[f];c.needsSpace&&(a(n,r).h(10).addTo(u),n+=10),c.format(n,r,c.width+c.offsetX).addTo(u),n+=c.width+c.offsetX,r+=c.height,c.needsSpace&&(a(n,r).h(10).addTo(u),n+=10)}return this.attrs.width=this.width+s+i,this.attrs.height=this.up+this.height+this.down+t+e,this.attrs.viewBox="0 0 "+this.attrs.width+" "+this.attrs.height,u.addTo(this),this.formatted=!0,this},d.prototype.addTo=function(t){var i=document.getElementsByTagName("script");i=i[i.length-1];var h=i.parentNode;return t=t||h,this.$super.addTo.call(this,t)},d.prototype.toSVG=function(){return this.formatted||this.format(),this.$super.toSVG.call(this)},d.prototype.toString=function(){return this.formatted||this.format(),this.$super.toString.call(this)},i(f,o),f.prototype.format=function(t,i,h){var s=e(h,this.width);a(t,i).h(s[0]).addTo(this),a(t+s[0]+this.width,i+this.height).h(s[1]).addTo(this),t+=s[0];for(var n=0;n<this.items.length;n++){var r=this.items[n];r.needsSpace&&(a(t,i).h(10).addTo(this),t+=10),r.format(t,i,r.width).addTo(this),t+=r.width,i+=r.height,r.needsSpace&&(a(t,i).h(10).addTo(this),t+=10)}return this},i(c,o),c.prototype.format=function(t,i,h){for(var e=t,s=0;s<this.items.length;s++){var n=this.items[s];n.needsSpace&&(a(t,i).h(10).addTo(this),t+=10),n.format(t,i,Math.max(n.width+n.offsetX,2*d.ARC_RADIUS)).addTo(this),t+=Math.max(n.width+n.offsetX,2*d.ARC_RADIUS),i+=n.height,n.needsSpace&&(a(t,i).h(10).addTo(this),t+=10),s!==this.items.length-1&&(a(t,i).arc("ne").down(Math.max(n.down,d.VERTICAL_SEPARATION)).arc("es").left(t-e-2*d.ARC_RADIUS).arc("nw").down(Math.max(this.items[s+1].up,d.VERTICAL_SEPARATION)).arc("ws").addTo(this),i+=Math.max(n.down,d.VERTICAL_SEPARATION)+Math.max(this.items[s+1].up,d.VERTICAL_SEPARATION)+4*d.ARC_RADIUS,t=e+2*d.ARC_RADIUS)}return a(t,i).h(h-(this.width+this.offsetX)).addTo(this),this},i(p,o),p.prototype.format=function(t,i,h){var s=e(h,this.width);a(t,i).h(s[0]).addTo(this),a(t+s[0]+this.width,i+this.height).h(s[1]).addTo(this),t+=s[0];for(var n=this.items.length-1,r=this.width-4*d.ARC_RADIUS,o=this.normal-1;o>=0;o--){var u=this.items[o];if(o==this.normal-1)var f=Math.max(2*d.ARC_RADIUS,this.items[o+1].up+d.VERTICAL_SEPARATION+u.height+u.down);a(t,i).arc("se").up(f-2*d.ARC_RADIUS).arc("wn").addTo(this),u.format(t+2*d.ARC_RADIUS,i-f,r).addTo(this),a(t+2*d.ARC_RADIUS+r,i-f+u.height).arc("ne").down(f-u.height+this.items[this.normal].height-2*d.ARC_RADIUS).arc("ws").addTo(this),f+=Math.max(d.ARC_RADIUS,u.up+d.VERTICAL_SEPARATION+(0==o?0:this.items[o-1].down+this.items[o-1].height))}a(t,i).right(2*d.ARC_RADIUS).addTo(this),this.items[this.normal].format(t+2*d.ARC_RADIUS,i,r).addTo(this),a(t+2*d.ARC_RADIUS+r,i+this.height).right(2*d.ARC_RADIUS).addTo(this);for(var o=this.normal+1;n>=o;o++){var u=this.items[o];if(o==this.normal+1)var f=Math.max(2*d.ARC_RADIUS,this.items[o-1].height+this.items[o-1].down+d.VERTICAL_SEPARATION+u.up);a(t,i).arc("ne").down(f-2*d.ARC_RADIUS).arc("ws").addTo(this),u.format(t+2*d.ARC_RADIUS,i+f,r).addTo(this),a(t+2*d.ARC_RADIUS+r,i+f+u.height).arc("se").up(f-2*d.ARC_RADIUS+u.height-this.items[this.normal].height).arc("wn").addTo(this),f+=Math.max(d.ARC_RADIUS,u.height+u.down+d.VERTICAL_SEPARATION+(o==n?0:this.items[o+1].up))}return this},i(A,o),A.prototype.needsSpace=!0,A.prototype.format=function(t,i,h){var s=e(h,this.width);a(t,i).h(s[0]).addTo(this),a(t+s[0]+this.width,i+this.height).h(s[1]).addTo(this),t+=s[0],a(t,i).right(d.ARC_RADIUS).addTo(this),this.item.format(t+d.ARC_RADIUS,i,this.width-2*d.ARC_RADIUS).addTo(this),a(t+this.width-d.ARC_RADIUS,i+this.height).right(d.ARC_RADIUS).addTo(this);var n=Math.max(2*d.ARC_RADIUS,this.item.height+this.item.down+d.VERTICAL_SEPARATION+this.rep.up);return a(t+d.ARC_RADIUS,i).arc("nw").down(n-2*d.ARC_RADIUS).arc("ws").addTo(this),this.rep.format(t+d.ARC_RADIUS,i+n,this.width-2*d.ARC_RADIUS).addTo(this),a(t+this.width-d.ARC_RADIUS,i+n+this.rep.height).arc("se").up(n-2*d.ARC_RADIUS+this.rep.height-this.item.height).arc("en").addTo(this),this},i(R,o),R.prototype.format=function(t,i){return this.attrs.d=this.simpleType===!1?"M "+t+" "+(i-10)+" v 20 m 0 -10 h 20.5":"M "+t+" "+(i-10)+" v 20 m 10 -20 v 20 m -10 -10 h 20.5",this},i(l,o),l.prototype.format=function(t,i){return this.attrs.d=this.simpleType===!1?"M "+t+" "+i+" h 20 m 0 -10 v 20":"M "+t+" "+i+" h 20 m -10 -10 v 20 m 10 -20 v 20",this},i(g,o),g.prototype.needsSpace=!0,g.prototype.format=function(t,i,h){var s=e(h,this.width);a(t,i).h(s[0]).addTo(this),a(t+s[0]+this.width,i).h(s[1]).addTo(this),t+=s[0],o("rect",{x:t,y:i-11,width:this.width,height:this.up+this.down,rx:10,ry:10}).addTo(this);var n=o("text",{x:t+this.width/2,y:i+4},this.text);return this.href?o("a",{"xlink:href":this.href},[n]).addTo(this):n.addTo(this),this},i(S,o),S.prototype.needsSpace=!0,S.prototype.format=function(t,i,h){var s=e(h,this.width);a(t,i).h(s[0]).addTo(this),a(t+s[0]+this.width,i).h(s[1]).addTo(this),t+=s[0],o("rect",{x:t,y:i-11,width:this.width,height:this.up+this.down}).addTo(this);var n=o("text",{x:t+this.width/2,y:i+4},this.text);return this.href?o("a",{"xlink:href":this.href},[n]).addTo(this):n.addTo(this),this},i(T,o),T.prototype.needsSpace=!0,T.prototype.format=function(t,i,h){var s=e(h,this.width);return a(t,i).h(s[0]).addTo(this),a(t+s[0]+this.width,i+this.height).h(s[1]).addTo(this),t+=s[0],o("text",{x:t+this.width/2,y:i+5,"class":"comment"},this.text).addTo(this),this},i(I,o),I.prototype.format=function(t,i,h){return a(t,i).right(h).addTo(this),this};var _;"function"==typeof define&&define.amd?(_={},define([],function(){return _})):_="object"==typeof exports?exports:this;var v=[d,u,f,c,p,m,A,w,g,S,T,I];["Diagram","ComplexDiagram","Sequence","Stack","Choice","Optional","OneOrMore","ZeroOrMore","Terminal","NonTerminal","Comment","Skip"].forEach(function(t,i){_[t]=v[i]})}).call(this,{VERTICAL_SEPARATION:8,ARC_RADIUS:10,DIAGRAM_CLASS:"railroad-diagram",STROKE_ODD_PIXEL_LENGTH:!0,INTERNAL_ALIGNMENT:"center"});